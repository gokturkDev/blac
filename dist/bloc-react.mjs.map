{"version":3,"file":"bloc-react.mjs","sources":["../src/lib/constants.ts","../src/lib/StreamAbstraction.ts","../src/lib/BlocBase.ts","../src/lib/Bloc.ts","../src/lib/Cubit.ts","../src/lib/BlocObserver.ts","../src/lib/BlocConsumer.ts","../src/lib/react/BlocReact.tsx"],"sourcesContent":["import { BlocOptions } from \"./types\";\n\nexport const LOCAL_STORAGE_PREFIX = \"data.\";\n\nexport const cubitDefaultOptions: Required<BlocOptions> = {\n  persistKey: \"\",\n  persistData: true,\n};\n","import { BehaviorSubject, Subscription } from \"rxjs\";\nimport { BlocOptions } from \"./types\";\nimport { cubitDefaultOptions, LOCAL_STORAGE_PREFIX } from \"./constants\";\n\nexport default class StreamAbstraction<T> {\n  protected readonly _options: BlocOptions;\n  private _subject: BehaviorSubject<T>;\n\n  constructor(initialValue: T, blocOptions: BlocOptions = {}) {\n    let value: any = initialValue;\n    const options = { ...cubitDefaultOptions, ...blocOptions };\n    this._options = options;\n\n    if (options.persistKey && options.persistData) {\n      const cachedValue = this.getCachedValue();\n      if (!(cachedValue instanceof Error)) {\n        value = cachedValue;\n      }\n    }\n\n    this._subject = new BehaviorSubject(value);\n  }\n\n  public get state(): T {\n    return this._subject.getValue();\n  }\n\n  public subscribe = (\n    next?: (value: T) => void,\n    error?: (error: any) => void,\n    complete?: () => void\n  ): Subscription => this._subject.subscribe(next, error, complete);\n\n  public complete = (): void => this._subject.complete();\n\n  public clearCache = (): void => {\n    const key = this._options.persistKey;\n    if (key) {\n      localStorage.removeItem(`${LOCAL_STORAGE_PREFIX}${key}`);\n    }\n  };\n\n  jsonToState(state: string): T {\n    return JSON.parse(state).state;\n  };\n\n  stateToJson(state: T): string {\n    return JSON.stringify({ state });\n  };\n\n  protected next = (value: T): void => {\n    this._subject.next(value);\n    this.updateCache();\n  };\n\n  protected getCachedValue = (): T | Error => {\n    const cachedValue = localStorage.getItem(\n      `${LOCAL_STORAGE_PREFIX}${this._options.persistKey}`\n    );\n    if (cachedValue) {\n      try {\n        return this.jsonToState(cachedValue);\n      } catch (e) {\n        const error = new Error(\n          `Failed to parse JSON in localstorage for the key: \"${LOCAL_STORAGE_PREFIX}${this._options.persistKey}\"`\n        );\n        console.error(error);\n        return error;\n      }\n    }\n    return new Error(\"Key not found\");\n  };\n\n  protected updateCache = (): void => {\n    const { persistData, persistKey } = this._options;\n    if (persistData && persistKey) {\n      localStorage.setItem(\n        `${LOCAL_STORAGE_PREFIX}${persistKey}`,\n        this.stateToJson(this.state)\n      );\n    } else {\n      this.clearCache();\n    }\n  };\n}\n","import { BlocConsumer } from \"./BlocConsumer\";\nimport StreamAbstraction from \"./StreamAbstraction\";\nimport { BlocOptions, ChangeEvent } from \"./types\";\n\nexport default class BlocBase<T> extends StreamAbstraction<T> {\n  _localProviderRef = \"\";\n  onRegister: null | ((consumer: BlocConsumer) => void) = null;\n  onChange: null | ((change: ChangeEvent<T>) => void) = null;\n\n  constructor(initialValue: T, blocOptions: BlocOptions = {}) {\n    super(initialValue, blocOptions);\n  }\n\n  protected _consumer: BlocConsumer | null = null;\n\n  set consumer(consumer: BlocConsumer) {\n    this._consumer = consumer;\n  }\n\n  protected notifyChange = (state: T): void => {\n    this._consumer?.notifyChange(this, state);\n\n    this.onChange?.({\n      currentState: this.state,\n      nextState: state,\n    });\n  };\n}\n","import BlocBase from \"./BlocBase\";\nimport { BlocOptions } from \"./types\";\n\nexport default class Bloc<E, T> extends BlocBase<T> {\n  onTransition:\n    | null\n    | ((change: { currentState: T; event: E; nextState: T }) => void) = null;\n  protected mapEventToState: null | ((event: E) => T) = null;\n\n  constructor(initialState: T, options?: BlocOptions) {\n    super(initialState, options);\n  }\n\n  public add = (event: E): void => {\n    if (this.mapEventToState) {\n      const newState = this.mapEventToState(event);\n      this.notifyChange(newState);\n      this.notifyTransition(newState, event);\n      this.next(newState);\n    } else {\n      console.error(\n        `\"mapEventToState\" not implemented for \"${this.constructor.name}\"`\n      );\n    }\n  };\n\n  protected notifyTransition = (state: T, event: E): void => {\n    this._consumer?.notifyTransition(this, state, event);\n    this.onTransition?.({\n      currentState: this.state,\n      event,\n      nextState: state,\n    })\n  };\n}\n","import BlocBase from \"./BlocBase\";\n\nexport default class Cubit<T> extends BlocBase<T> {\n  public emit = (value: T): void => {\n    this.notifyChange(value);\n    this.next(value);\n  };\n}\n","import BlocBase from \"./BlocBase\";\nimport { ChangeEvent, TransitionEvent } from \"./types\";\n\nexport interface BlocObserverOptions {\n  onChange?: (bloc: BlocBase<any>, event: ChangeEvent<any>) => void;\n  onTransition?: (bloc: BlocBase<any>, event: TransitionEvent<any, any>) => void;\n}\n\nexport default class BlocObserver {\n  onChange: (bloc: BlocBase<any>, event: ChangeEvent<any>) => void\n  onTransition: (bloc: BlocBase<any>, event: TransitionEvent<any, any>) => void\n\n  constructor(methods: BlocObserverOptions = {}) {\n    this.onChange = methods.onChange ? methods.onChange : () => {};\n    this.onTransition = methods.onTransition ? methods.onTransition : () => {};\n  }\n\n  readonly addChange = (bloc: BlocBase<any>, state: any) => {\n    this.onChange(bloc, this.createChangeEvent(bloc, state));\n  }\n\n  readonly addTransition = (bloc: BlocBase<any>, state: any, event: any) => {\n    this.onTransition(bloc, this.createTransitionEvent(bloc, state, event));\n  }\n\n\n  private createTransitionEvent(bloc: BlocBase<any>, state: any, event: any): TransitionEvent<any, any> {\n    return {\n      currentState: bloc.state,\n      event,\n      nextState: state,\n    }\n  }\n\n  private createChangeEvent(bloc: BlocBase<any>, state: any): ChangeEvent<any> {\n    return {\n      currentState: bloc.state,\n      nextState: state,\n    }\n  }\n}","import BlocBase from \"./BlocBase\";\nimport { BlocClass, ChangeEvent, ValueType } from \"./types\";\nimport BlocObserver from \"./BlocObserver\";\n\nexport interface ReactBlocOptions {\n  /** Enables debugging which calls BlocReact.observer every time a Subject is updated. Defaults to false */\n  debug?: boolean;\n}\n\nexport type BlocObserverScope = \"local\" | \"global\" | \"all\";\ntype BlocObserverList = [\n  BlocClass<any>,\n  (bloc: any, event: ChangeEvent<any>) => unknown,\n  BlocObserverScope\n];\n\nexport class BlocConsumer {\n  observer: BlocObserver;\n  debug: boolean;\n  public mocksEnabled = false;\n  protected _blocMapLocal: Record<string, BlocBase<any>> = {};\n  private blocListGlobal: BlocBase<any>[];\n  private blocObservers: BlocObserverList[] = [];\n  private mockBlocs: BlocBase<any>[] = [];\n\n  constructor(blocs: BlocBase<any>[], options: ReactBlocOptions = {}) {\n    this.blocListGlobal = blocs;\n    this.debug = options.debug || false;\n    this.observer = new BlocObserver();\n\n    for (const b of blocs) {\n      b.consumer = this;\n      // b.subscribe((v: any) => this.notifyChange(b, v));\n      b.onRegister?.(this);\n    }\n  }\n\n  notifyChange(bloc: BlocBase<any>, state: any): void {\n    this.observer.addChange(bloc, state);\n\n    for (const [blocClass, callback, scope] of this.blocObservers) {\n      const isGlobal = this.blocListGlobal.indexOf(bloc) !== -1;\n      const matchesScope =\n        scope === \"all\" ||\n        (isGlobal && scope === \"global\") ||\n        (!isGlobal && scope === \"local\");\n      if (matchesScope && bloc instanceof blocClass) {\n        callback(bloc, {\n          nextState: state,\n          currentState: bloc.state\n        });\n      }\n    }\n  }\n\n  notifyTransition(bloc: BlocBase<any>, state: any, event: any): void {\n    this.observer.addTransition(bloc, state, event);\n  }\n\n  public addBlocObserver<T extends BlocBase<any>>(\n    blocClass: BlocClass<T>,\n    callback: (bloc: T, event: ChangeEvent<ValueType<T>>) => unknown,\n    scope: BlocObserverScope = \"all\"\n  ) {\n    this.blocObservers.push([blocClass, callback, scope]);\n  }\n\n  public addLocalBloc(key: string, bloc: BlocBase<any>) {\n    this._blocMapLocal[key] = bloc;\n    bloc.consumer = this;\n  }\n\n  public removeLocalBloc(key: string) {\n    const bloc = this._blocMapLocal[key];\n    bloc.complete();\n    delete this._blocMapLocal[key];\n  }\n\n  // TODO: Add direct unit tests for mocks\n  public addBlocMock(bloc: BlocBase<any>): void {\n    if (this.mocksEnabled) {\n      this.mockBlocs = [bloc, ...this.mockBlocs];\n    }\n  }\n  public resetMocks(): void {\n    this.mockBlocs = [];\n  }\n\n  protected getBlocInstance<T>(global: BlocBase<any>[], blocClass: BlocClass<T>): BlocBase<T> | undefined {\n    if (this.mocksEnabled) {\n      const mockedBloc = this.mockBlocs.find((c) => c instanceof blocClass)\n      if (mockedBloc) {\n        return mockedBloc\n      }\n    }\n\n\n    return global.find((c) => c instanceof blocClass);\n  }\n}\n","import React, { ReactElement, useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport { nanoid } from \"nanoid\";\nimport BlocBase from \"../BlocBase\";\nimport { BlocClass, BlocHookData, ValueType } from \"../types\";\nimport { BlocConsumer } from \"../BlocConsumer\";\n\ninterface ReactBlocOptions {\n  /** Enables debugging which calls BlocReact.observer every time a Subject is updated. Defaults to false */\n  debug?: boolean;\n}\n\ninterface BlocHookOptions<T extends BlocBase<any>> {\n  subscribe?: boolean;\n  shouldUpdate?: (previousState: ValueType<T>, state: ValueType<T>) => boolean;\n}\n\nconst defaultBlocHookOptions: BlocHookOptions<any> = {\n  subscribe: true\n};\n\nclass BlocRuntimeError {\n  error: Error;\n\n  constructor(message?: string) {\n    this.error = new Error(message);\n  }\n}\n\nclass NoValue {\n}\n\nexport class BlocReact extends BlocConsumer {\n  private readonly _blocsGlobal: BlocBase<any>[];\n  // private readonly _contextGlobal: React.Context<BlocBase<any>[]>;\n  private _contextLocalProviderKey = React.createContext(\"\");\n\n  constructor(blocs: BlocBase<any>[], options: ReactBlocOptions = {}) {\n    super(blocs, options);\n    this._blocsGlobal = blocs;\n    // this._contextGlobal = React.createContext(blocs);\n  }\n\n  useBloc = <T extends BlocBase<any>>(\n    blocClass: BlocClass<T>,\n    options: BlocHookOptions<T> = {}\n  ): BlocHookData<T> => {\n    const mergedOptions: BlocHookOptions<T> = {\n      ...defaultBlocHookOptions,\n      ...options\n    };\n\n    const localProviderKey = useContext(this._contextLocalProviderKey);\n    const localBlocInstance = this._blocMapLocal[localProviderKey];\n\n    const { subscribe, shouldUpdate = true } = mergedOptions;\n    // const blocs = useContext(this._contextGlobal);\n    // const blocInstance = localBlocInstance || blocs.find((c) => c instanceof blocClass);\n\n    const blocInstance = localBlocInstance || this.getBlocInstance(this._blocsGlobal, blocClass);\n\n    if (!blocInstance) {\n      const name = blocClass.prototype.constructor.name;\n      const error = new BlocRuntimeError(`\"${name}\" \n      no bloc with this name was found in the global context.\n      \n      # Solutions:\n      \n      1. Wrap your code in a BlocProvider.\n      \n      2. Add \"${name}\" to the \"BlocReact\" constructor:\n        const state = new BlocReact(\n          [\n            ...\n            new ${name}(),\n          ]\n        )\n      `);\n      console.error(error.error);\n      return ([\n        NoValue,\n        {},\n        {\n          error,\n          complete: true\n        }\n      ] as unknown) as BlocHookData<T>;\n    }\n\n    const [data, setData] = useState(blocInstance.state);\n\n    const updateData = useCallback((newState: ValueType<T>) => {\n      if (shouldUpdate === true || shouldUpdate(data, newState)) {\n        setData(newState);\n      }\n    }, []);\n\n    useEffect(() => {\n      if (subscribe) {\n        const subscription = blocInstance.subscribe(updateData);\n        return () => subscription.unsubscribe();\n      }\n    }, []);\n\n    return [\n      data,\n      blocInstance as T\n    ];\n  };\n\n  // Components\n  BlocBuilder = <T extends BlocBase<any>>(props: {\n    blocClass: BlocClass<T>;\n    builder: (data: BlocHookData<T>) => ReactElement;\n    shouldUpdate?: (\n      previousState: ValueType<T>,\n      state: ValueType<T>\n    ) => boolean;\n  }): ReactElement | null => {\n    const hook = this.useBloc(props.blocClass, {\n      shouldUpdate: props.shouldUpdate\n    });\n    return props.builder(hook);\n  };\n\n  BlocProvider = <T extends BlocBase<any>>(props: {\n    children?: ReactElement | ReactElement[];\n    create: (providerKey: string) => T;\n  }): ReactElement => {\n    const providerKey = useMemo(() => \"p_\" + nanoid(), []);\n\n    const bloc = useMemo<T>(() => {\n      const newBloc = props.create(providerKey);\n      newBloc._localProviderRef = providerKey;\n      this.addLocalBloc(providerKey, newBloc);\n\n      return newBloc;\n    }, []);\n\n    const context = useMemo<React.Context<BlocBase<any>>>(() => {\n      return React.createContext<BlocBase<any>>(bloc);\n    }, [bloc]);\n\n    useEffect(() => {\n      return () => {\n        this.removeLocalBloc(providerKey);\n      };\n    }, []);\n\n    return (\n      <this._contextLocalProviderKey.Provider value={providerKey}>\n        <context.Provider value={bloc}>{props.children}</context.Provider>\n      </this._contextLocalProviderKey.Provider>\n    );\n  };\n\n  // GlobalProvider: FC<{blocs?: BlocBase<any>[]}> = (props): ReactElement => {\n  //   return <this._contextGlobal.Provider value={props.blocs || this._blocsGlobal}>\n  //     {props.children}\n  //   </this._contextGlobal.Provider>\n  // }\n}\n"],"names":[],"mappings":"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"}